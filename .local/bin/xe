#!/bin/bash
# base code: https://github.com/pzmarzly/x11-input-mirror/tree/0.2.2/Xephyr

while :
do
    RAND=`shuf -i 1000-2000000000 -n 1`
    FILE="/tmp/.X11-unix/X$RAND"
    echo "Trying DISPLAY=:$RAND..."
    if [ ! -f $FILE ]; then
        break
    fi
done

echo "Starting XWayland on DISPLAY=:$RAND"
#Xephyr :$RAND
Xwayland -retro -noreset :$RAND

while :
do
    if [ -e $FILE ]; then
        sleep 0.3
        break
    fi
    sleep 0.1
done

DISPLAY=:$RAND twm &
DISPLAY=:$RAND setbg "/home/knox/BGs/Render_test_buildings.png" &
sleep 1
DISPLAY=:$RAND $*

wait
exit 0
